## Docker 이미지 & 컨테이너: 코어 빌딩 블록

### 이미지 & 컨테이너: 무엇이며, 왜 사용하는가?

컨테이너는 앱, 웹, 노드서버 앱을 실행하는 전체환경 등 무엇이든 포함하는 작은 패키지
컨테이너에 소프트웨이 실행 유닛이 존재한다. 그 유닛을 우리가 실행하는것
이미지라는 디졸버 개념도 필요하다.
이미지는 템플릿, 컨테이너의 블루프린트가 될 것이기 때문이다.
이미지는 실제로 코드와 코드를 실행하는데 필요한 도구모음이다. 그런 다음 컨테이너가 실행되어 코드를 실행한다.
이미지를 기반으로 여러 컨테이너를 만들 수 있다.

### 외부 이미지의 사용 & 실행

-it 컨테이너 내부에서 호스팅 머신으로 대화형 세션을 노출하고 싶다고 알리는 것

### 우리의 목표 NodeJS 앱

### DockerFile을 사용하여 자체 이미지 빌드하기

### 자체 이미지를 기반으로 컨테이너 실행하기

### EXPOSE & 약간의 유틸리티 기능

EXPOSE 는 선택사항이다. 컨테이너의 프로세스가 해당 포트를 노출할 것임을 문서화하는것임. 하지만 docker run을 실행할 때 -p를 사용하여
실제로 포트를 노출해야한다. 따라서 기술적으로 -p는 포트에서 수신대기할 때 유일하게 필요한 부분이다. 하지만 Dockerfile에 EXPOSE를 추가하여
동작을 문서화하는 것이 모범적인 사용방법이므로 EXPOSE를 추가하는 것이 좋다.

### 이미지는 읽기 전용!

### 이미지 레이어 이해하기

이미지를 빌드하거나 이미지를 재빌드할때 변경된 부분의 명령과 그이후의 모든 명령이 재평가 된다. 도커는 기본적으로 모든 명령어에 대해
명령어를 다시 실행했을때의 결과가 이전과 동일하다면 캐시를 사용한다. 따라서 도커는 빌드할때마다 모든 명령 결과를 캐시하고 이미지를 다시 빌드할 때
명령을 다시 실행할 필요가 없다면 캐시된 결과를 사용한다. 이를 레이어 기반 아키텍쳐라고 함.

한 명령어에서 결과값이 바뀌면 뒤의 모든 명령결과값을 삭제하고 다시 캐시한다.

### 첫번째 요약

### 이미지 & 컨테이너 관리

### 컨테이너 중지 & 재시작

docker --help 실행가능한 내장 명령어 목록 확인
docker ps 컨테이너 리스트 -a 중지된 컨테이너 포함 확인
docekr run 컨테이너 생성
docker start 컨테이너 재실행
docker stop 컨테이너 중지

### Attached & Detached컨테이너 이해하기

docker start detached

docker run attached
docker run -p detached 모드 실행

docker attach {컨테이너 이름} 실행되고 있는 컨테이너 attached 모드 실행

docker logs {컨테이너 이름} 이때까지 출력된 로그 확인
docker logs -f {컨테이너 이름} 수신대기

### 이미 실행 중인 컨테이너에 연결하기

### 인터렉티브 모드로 들어가기

docker run -it {이미지 이름}

### 이미지 & 컨테이너 삭제하기

docker rm {컨테이너 이름} {컨테이너 이름} {컨테이너 이름} 컨테이너 제거
docker rmi {이미지 id} 이미지 제거
docker image prune 사용되지않는 이미지 모두 제거

### 중지된 컨테이너 자동 제거하기

docker run --rm {이미지 id} 컨테이너 중지시 해당 컨테이너 제거

### 작동 배경 살펴보기: 이미지 검사

이미지에는 코드와 애플리케이션 환경이 포함되어 있다. 용량이 큼
실행중인 컨테이너는 실제로 크지않으며 명령 레이어가 이미지 위에 추가된 얇은 부가 레이어이다.
이미지의 코드가 실행중인 컨테이너에서 사용된다.
컨테이너는 이미지를 기반으로 빌드되고 동일한 이미지를 기반으로 실행되는 여러 컨테이너는 이미지 내부의 코드를 공유한다.
이미지 내부의 코드는 잠겨있다. 읽기전용 컨테이너만 변경할수 있다.
이미지 레이어 위에 추가된 새로운 얇은 부가 컨테이너 레이어 내부에 파일을 만든다.

docker image inspect {이미지 id} 이미지에 대한 정보 확인

- 이미지 전체 id
- 생성 날짜 및 시간
- 컨테이너 구성
- 포트
- 환경변수
- 진입점
- 도커버전
- 운영체제

### 컨테이너에/컨테이너로 부터 파일 복사하기

docker cp {복사할 파일 경로} {컨테이너 이름}:{복사되는 경로} 로컬에서 컨테이너로
docker cp {컨테이너 이름}:{복사할 파일 경로} {복사되는 경로} 컨테이너에서 로컬로

- 실행중인 컨테이너 혹은 실행중인 컨테이너 밖으로 파일 또는 폴더를 복사함.

### 컨테이너와 이미지에 이름 지정 & 태그 지정하기

docker build -t {사용할 이미지 이름}:{태그} 이미지 생성시 이름:태그 구성

docker run --name {사용할 컨테이너 이름}

### 이미지 공유하기

이미지를 가지고 있으면 해당 이미지를 기반으로 컨테이너를 구성할 수 있다.
컨테이너를 공유하지않는다. 이미지를 공유한다.
도커파일과 소스들을 공유해도된다. 자체적으로 이미지를 빌드하고 컨테이너를 생성한다.

### DockerHub에 이미지 푸시하기

이미지 공유시 docker hub 혹은 private registry에 공유를 한다.

### 공유 이미지 가져오기 & 사용하기

### 요약

도커는 이미지와 컨테이너에 관한 모든 것이다.
이미지는 템플릿 컨테이너의 블루프린트이며
하나의 동일한 이미지를 기반으로 하는 여러 컨테이너를 실행할 수 있으며
다양한 컨테이너를 위해 여러 이미지를 가질 수도 있다.
그리고 이러한 컨테이너가 이미지 위에 작은 레이어로 효율적인 방식으로 실행이 된다.
컨테이너가 아닌 이미지에 저장된 코드와 환경을 사용하며
이미지의 도움으로 설정 및 구성된 애플리케이션을 작동시킨다.
